# ‚öôÔ∏è Infraestructura como C√≥digo (IaC)

## üìë √çndice
* [üß≠ Descripci√≥n](#-descripci√≥n)
* [üìò Detalles](#-detalles)
* [üíª Laboratorio Pr√°ctico (CLI-TDD)](#-laboratorio-pr√°ctico-cli-tdd)
* [üí° Lecciones Aprendidas](#-lecciones-aprendidas)
* [‚ö†Ô∏è Errores y Confusiones Comunes](#Ô∏è-errores-y-confusiones-comunes)
* [üéØ Tips de Examen](#-tips-de-examen)
* [üßæ Resumen](#-resumen)
* [‚úçÔ∏è Firma](#-firma)
* [‚¨ÜÔ∏è Volver arriba](#Ô∏è-infraestructura-como-c√≥digo-iac)

---

## üß≠ Descripci√≥n

La Infraestructura como C√≥digo (IaC) es la pr√°ctica de gestionar y aprovisionar la infraestructura (redes, VMs, balanceadores de carga, etc.) a trav√©s de ficheros de definici√≥n legibles por m√°quina, en lugar de hacerlo mediante configuraci√≥n manual o herramientas interactivas. Trata a la infraestructura como si fuera software: el mismo c√≥digo siempre produce el mismo resultado. Esto permite la automatizaci√≥n, el versionado y la validaci√≥n, haciendo que los despliegues de infraestructura sean m√°s r√°pidos, repetibles y seguros.

---

## üìò Detalles

### Enfoques de IaC

Existen dos enfoques principales para la IaC:

1.  **Imperativo (Procedural):** Defines una secuencia de comandos que se deben ejecutar para alcanzar el estado deseado. Es como dar una receta paso a paso. Si ejecutas los mismos pasos dos veces, el resultado puede no ser el mismo (ej. intentar crear un recurso que ya existe puede dar un error).
    *   **Ejemplo:** Scripts de `gcloud` o `bash`.

2.  **Declarativo (Funcional):** Defines el **estado final deseado** de la infraestructura y la herramienta de IaC se encarga de averiguar c√≥mo llegar a √©l. Si ejecutas la misma definici√≥n varias veces, la herramienta es lo suficientemente inteligente como para no hacer nada si la infraestructura ya est√° en el estado deseado.
    *   **Ejemplo:** Terraform, Google Cloud Deployment Manager.

El enfoque **declarativo** es el preferido para la gesti√≥n de infraestructura a escala por su previsibilidad y robustez.

### Herramientas Populares de IaC en GCP

*   **Terraform:** Es la herramienta de IaC de c√≥digo abierto m√°s popular y el est√°ndar de facto en la industria. Utiliza su propio lenguaje declarativo (HCL - HashiCorp Configuration Language). Google mantiene activamente el "provider" de GCP para Terraform.
*   **Google Cloud Deployment Manager:** La herramienta de IaC nativa de Google. Utiliza plantillas YAML y es una buena opci√≥n si quieres mantenerte 100% dentro del ecosistema de Google, aunque Terraform es m√°s utilizado.
*   **Pulumi:** Permite definir la infraestructura usando lenguajes de programaci√≥n de prop√≥sito general como Python, TypeScript o Go.
*   **Ansible, Chef, Puppet:** Son herramientas de gesti√≥n de la configuraci√≥n, a menudo utilizadas en un enfoque imperativo para configurar el software *dentro* de las VMs, complementando a herramientas declarativas como Terraform.

---

## üíª Laboratorio Pr√°ctico (CLI-TDD)

### üìã Escenario 1: Desplegar una VM usando Terraform
**Contexto:** Usaremos Terraform para definir y desplegar una VM de Compute Engine. Este laboratorio demuestra el flujo de trabajo declarativo b√°sico: `init`, `plan`, `apply`.

#### ARRANGE (Preparaci√≥n del laboratorio)
*Este laboratorio asume que tienes Terraform instalado localmente.*
```bash
# Habilitar APIs
gcloud services enable compute.googleapis.com --project=$PROJECT_ID

# Variables
export PROJECT_ID=$(gcloud config get-value project)
export REGION="europe-west1"

# Crear un fichero de definici√≥n de Terraform
mkdir terraform-lab && cd terraform-lab
cat <<EOT > main.tf
terraform {
  required_providers {
    google = {
      source  = "hashicorp/google"
      version = "4.51.0"
    }
  }
}

provider "google" {
  project = "$PROJECT_ID"
  region  = "$REGION"
}

resource "google_compute_instance" "vm_terraform" {
  name         = "vm-declarativa"
  machine_type = "e2-micro"
  zone         = "${REGION}-b"

  boot_disk {
    initialize_params {
      image = "debian-cloud/debian-11"
    }
  }

  network_interface {
    network = "default"
  }
}
EOT
```

#### ACT (Implementaci√≥n del escenario)
*Inicializamos Terraform, vemos el plan de ejecuci√≥n y luego lo aplicamos.*
```bash
# 1. Inicializar Terraform (descarga el provider de Google)
echo "\n=== Inicializando Terraform... ==="
terraform init

# 2. Crear un plan de ejecuci√≥n (muestra qu√© se va a crear)
echo "\n=== Planificando la ejecuci√≥n... ==="
terraform plan

# 3. Aplicar el plan para crear la infraestructura
echo "\n=== Aplicando el plan... ==="
terraform apply -auto-approve
```

#### ASSERT (Verificaci√≥n de funcionalidades)
*Verificamos usando `gcloud` que la VM definida en nuestro c√≥digo de Terraform realmente existe en GCP.*
```bash
# Usar gcloud para verificar que la VM fue creada
echo "\n=== Verificando la creaci√≥n de la VM con gcloud... ==="
gcloud compute instances list --filter="name=vm-declarativa"
```

#### CLEANUP (Limpieza de recursos)
*Usamos Terraform para destruir toda la infraestructura que gestiona.*
```bash
# Destruir la infraestructura gestionada por Terraform
echo "\n=== Destruyendo la infraestructura... ==="
terraform destroy -auto-approve

# Limpiar ficheros locales
cd .. && rm -rf terraform-lab
```

---

## üí° Lecciones Aprendidas

*   **Declarativo > Imperativo:** Para la gesti√≥n de infraestructura, el enfoque declarativo es m√°s robusto, predecible y escalable.
*   **El c√≥digo es la fuente de la verdad:** La definici√≥n de la infraestructura vive en el control de versiones (Git). Cualquier cambio se realiza modificando el c√≥digo, no en la consola, lo que proporciona un historial de auditor√≠a completo.
*   **Idempotencia:** Las herramientas declarativas son idempotentes. Aplicar la misma configuraci√≥n varias veces no produce efectos secundarios si el sistema ya est√° en el estado deseado.

---

## ‚ö†Ô∏è Errores y Confusiones Comunes

*   **Realizar cambios manuales en la consola:** Si gestionas tu infraestructura con IaC, realizar cambios manuales en la consola crea un "drift" (desviaci√≥n) entre tu c√≥digo y el estado real, lo que puede causar problemas en futuros despliegues.
*   **No almacenar el fichero de estado (`.tfstate`) de forma segura:** El fichero de estado de Terraform contiene informaci√≥n sobre tu infraestructura. Debe ser almacenado de forma remota y segura (ej. en un bucket de Cloud Storage con versionado y bloqueo).
*   **Mezclar IaC con configuraci√≥n manual:** Es una receta para el desastre. Elige un enfoque y s√© consistente.

---

## üéØ Tips de Examen

*   **Terraform es la herramienta clave de IaC:** Aunque existen otras, Terraform es la m√°s prominente en la industria y en los escenarios de examen.
*   **Flujo de Terraform: `init`, `plan`, `apply`:** Conoce el prop√≥sito de cada uno de estos comandos.
*   **Declarativo vs. Imperativo:** Entiende la diferencia fundamental. Declarativo = "qu√© quiero", Imperativo = "c√≥mo lo hago".

---

## üßæ Resumen

La Infraestructura como C√≥digo (IaC) es una pr√°ctica fundamental de DevOps y SRE que aporta automatizaci√≥n, repetibilidad y seguridad a la gesti√≥n de la infraestructura. Al definir los recursos en c√≥digo, preferiblemente de forma declarativa con herramientas como Terraform, los equipos pueden desplegar y modificar infraestructuras complejas de manera r√°pida y fiable, eliminando el riesgo y la lentitud asociados a los procesos manuales.

---

## ‚úçÔ∏è Firma

**Marco - DevSecOps Kulture**  
*The Artisan Path*  
üìß Contacto: [markitos.es.info@gmail.com](mailto:markitos.es.info@gmail.com)  
üêô GitHub: [https://github.com/markitos-public](https://github.com/markitos-public)

---

[‚¨ÜÔ∏è **Volver arriba**](#Ô∏è-infraestructura-como-c√≥digo-iac)
